# Yellow_taxi_Final_project_Coursera
  По завершению специализации на Coursera "Машинное обучение и анализ данных" был создан финальный проект. Задача этого проекта — научиться предсказывать количество поездок в ближайшие часы в каждом районе Нью-Йорка. 
# Назначение
  Репозиторий создан с целью демонстрации применённых решений, стиля написания кода и демо-версии проекта. На Github собраны файлы, необходимые для получения только конечного результата, промежуточных решений нет.
# Исходные данные
  В данной работе использовались подробные данные о поездках "жёлтого" такси в Нью-Йорке, опубликованные на сайте [www.nyc.gov](http://www.nyc.gov/html/tlc/html/about/trip_record_data.shtml). Скачивание файлов выполняется следующим образом: внизу страницы жёлтая таблица Trip Sheet Data (CSV Format) выбираем 2016 год, а затем из столбца Yellow месяц.  
  Поскольку эти файлы тяжелые, их не будет непосредственно в проекте, мы подготовили агрегированные данные data_agg_w7.csv (подробно алгоритм загрузки, фильтрации и агрегации представлен в функции aggregate_data Dasha_Final_project_w7.ipynb).
# Библиотеки
  Для выполнения кода понадобится установка следующих библиотек:
* pandas (версия 0.20.3)
* numpy (версия 1.13.1)
* scipy (версия 0.19.1)
* matplotlib (версия 2.1.0)
* ipywidgets (версия 7.0.0)
* bqplot (версия 0.11.0)
* ipyleaflet (версия 0.9.0)
# Платформа
  Проект создавался на Windows 10 через Anaconda, для работы демо необходим Jupyter Notebook версии 5.0+.
# Ход решения
  Сырые данные были агрегированы по часам и районам. Агрегированные данные будут представлять собой почасовые временные ряды с количествами поездок из каждого района.  
  Поскольку мы агрегировали данные по равномерной сетке, можно ожидать, что некоторое количество ячеек окажется в районах города, где вызов такси невозможен (реки, заливы, острова, парки). Поэтому мы отобрали 102 наиболее популярных районов по такому критерию: ячейки, из которых в мае совершается в среднем не меньше 5 поездок в час.  
  Далее с помощью модели ARIMA мы выполнили прогнозирование временных рядов со сложной сезонностью, предварительно сделав кластеризацию этих рядов.  
  Так как класс моделей ARIMA недостаточно богат для наших данных, к напримеру, никак нельзя учесть взаимосвязи между рядами, необходимо свести задачу массового прогнозирования рядов к регрессионной постановке. Здесь прогноз модели ARIMA был взят в качестве одного из признаков новой модели. Перечислим и остальные признаки модели:
* идентификатор географической зоны — как вещественный, так и категориальный,
* непрерывные признаки года, месяца, дня, дня недели, часа,
* синусы и косинусы, использованные внутри регрессионной компоненты ARIMA,
* сами прогнозы ARIMA,
* количество поездок из рассматриваемого района в моменты времени   ,
* количество поездок из рассматриваемого района в моменты времени  ,
* суммарное количество поездок из рассматриваемого района за предшествующие полдня, сутки, неделю,
* категориальный признак час пиков и застоев,
а так же дополнительно:
* праздники и часовые коэффициенты в будни и выходные,
* географический признак: количество поездок, совершённых за прошлый час/день в текущую географическую зону.  
  
Экспериментировали с разными регрессионными моделями, лучшей оказалась ExtraTreesRegressor из sklearn.ensemble. Подробнее о соревновании по ссылке [www.kaggle.com](https://www.kaggle.com/neprostodaria).
# Функционал демо
  Интерактивное демо содержит:
* карты с визуализацией реального и прогнозируемого спроса на такси в выбираемый момент времени,
* временной ряд фактического и прогнозируемого спроса на такси в выбираемой области.  

Start - дата начала периода  
End - дата окончания периода  
Step - шаг прогноза (на ближайшие 1, 2, ..., 6 часов)  
На карту нанесены регионы Нью-Йорка, окрашенные по количеству среднего количества поездок.  
При наведении курсором мыши на интересующий район, он подсвечивается красным цветом, а график "New York yellow taxi trips" показывает фактический и прогнозируемый спросы на такси в указаный на момент времени, в указаном регионе.  
При нажатии правой кнопкой мыши на ячейку, мы можем увидеть детализированную информацию: номер зоны, количество часов (от 1 до 6), на которое будет продемонстрирован прогноз, значение прогноза, реальное значение количества поездок в районе в этот период, остаток факта от прогноза.
